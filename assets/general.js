window.onpopstate=function(e){location.href=document.location};var customFilters={eventsAssigned:new Array,uriLocationState:{page:"Results"},counterHist:0,assignEvents:function(e){0!=this.eventsAssigned[e]&&null!=this.eventsAssigned[e]||("btn"!=customFiltersProp[e].results_trigger&&"ajax"!=customFiltersProp[e].results_loading_mode||(document.id("cf_wrapp_all_"+e).addEvent("click:relay(a)",function(t){if(t.stop(),0==customFiltersProp[e].category_flt_parent_link&&this.hasClass("cf_parentOpt"))return!1;var s=this.get("href");customFilters.listen(t,this,e,s)}),document.id("cf_wrapp_all_"+e).addEvent("keydown:relay(a)",function(t){if("enter"!=t.key)return!1;if(t.stop(),0==customFiltersProp[e].category_flt_parent_link&&this.hasClass("cf_parentOpt"))return!1;var s=this.get("href");customFilters.listen(t,this,e,s)}),document.id("cf_wrapp_all_"+e).addEvent("click:relay(input[type=checkbox],input[type=radio])",function(t){var s="",i=document.id(this.get("id")+"_a");i&&(s=i.get("href")),customFilters.listen(t,this,e,s)}),document.id("cf_wrapp_all_"+e).addEvent("change:relay(select[class=cf_flt])",function(t){t.stop();var s=this.options[this.selectedIndex].getAttribute("data-url");customFilters.listen(t,this,e,s)})),"ajax"==customFiltersProp[e].results_loading_mode&&"btn"==customFiltersProp[e].results_trigger&&document.id("cf_wrapp_all_"+e).addEvent("click:relay(input[type=submit],button[type=submit])",function(t){t.preventDefault(),customFilters.listen(t,this,e)}),document.id("cf_wrapp_all_"+e).addEvent("click:relay(button[class=cf_search_button btn])",function(t){t.stop();var s="",i="",r="",o="",n=this.getProperty("id"),l=n.substr(0,n.indexOf("_button")),a=(s=document.id(l+"_url").value,s.indexOf("?")),u=document.id(l+"_0"),d=document.id(l+"_1");if(u&&d)var c=u.value,p=d.value,m=u.name,h=d.name;else{c=document.id(l+"_0").value;m=document.id(l+"_0").name}if(-1!=a)var f="&";else f="?";if(c&&(i=m+"="+c),p&&(r=h+"="+p),o+=i&&!r?f+i:!i&&r?f+r:f+i+"&"+r)var _=s+o;_&&("ajax"==customFiltersProp[e].results_loading_mode||"btn"==customFiltersProp[e].results_trigger?customFilters.listen(t,this,e,_):window.top.location.href=_)}),this.eventsAssigned[e]=!0)},listen:function(e,t,s,i){if(s){var r=!1,o="",n=i,l="";if(t.nodeType&&(r=t.hasClass("cf_apply_button")),void 0!==t.getProperty&&t.getProperty("id"))l=this.getFilterName(t.getProperty("id"));if(("q"==l||r)&&!this.validateInput(l,s))return!1;if(void 0!==customFiltersProp[s].mod_type&&"filtering"==customFiltersProp[s].mod_type){var a=document.getElementById("q_"+s+"_0");"virtuemart_category"==l&&void 0!==customFiltersProp[s].category_flt_onchange_reset&&"filters_keywords"==customFiltersProp[s].category_flt_onchange_reset&&(a=""),a&&(o=this.getQueryValue(s),void 0!==t.id&&t.id=="q_"+s+"_clear"&&(o=""),void 0===customFilters.previousQueryValue&&(customFilters.previousQueryValue=o),customFilters.keyword_search_clear_filters_on_new_search&&o!=customFilters.previousQueryValue&&(n=customFiltersProp[s].base_url+"index.php?option=com_customfilters&view=module&Itemid="+customFiltersProp[s].Itemid,o&&(-1==n.indexOf("?")?n+="?":n+="&",n+="q="+o)))}if("ajax"==customFiltersProp[s].results_loading_mode&&("btn"!=customFiltersProp[s].results_trigger||"btn"==customFiltersProp[s].results_trigger&&r)){if(void 0!==customFiltersProp[s].mod_type&&"filtering"==customFiltersProp[s].mod_type&&a){if(customFilters.keyword_search_clear_filters_on_new_search&&o!=customFilters.previousQueryValue){i=customFiltersProp[s].component_base_url;o&&(-1==i.indexOf("?")?i+="?":i+="&",i+="q="+o)}this.updateSearchModulesWithSearchQuery(o)}this.loadResults(s,i)}if(customFiltersProp[s].loadModule&&!r&&this.loadModule(e,s,n),customFiltersProp[s].loadOtherModules)if(o="",void 0!==(a=document.getElementById("q_"+s+"_0"))){o=this.getQueryValue(s),void 0===customFilters.previousQueryValue&&(customFilters.previousQueryValue=o),customFilters.keyword_search_clear_filters_on_new_search&&o!=customFilters.previousQueryValue&&(n=customFiltersProp[s].base_url+"index.php?option=com_customfilters&view=module",void 0!==t.id&&t.id=="q_"+s+"_clear"&&(o=""),o&&(-1==n.indexOf("?")?n+="?":n+="&",n+="q="+o));for(var u=this.getFilteringModules(),d=0;d<u.length;d++)this.updateFilteringModuleWithSearchQuery(u[d],o),this.loadModule(e,u[d],n)}this.setLastQueryValue(o)}},getQueryValue:function(e){return document.getElementById("q_"+e+"_0").value},setLastQueryValue:function(e){customFilters.previousQueryValue=e},generateURL:function(e,t){if(customFilters.keyword_search_clear_filters_on_new_search&&t!=customFilters.previousQueryValue){var s=customFiltersProp[e].component_base_url;if(t)return-1==s.indexOf("?")?s+="?":s+="&",s+="q="+t}return!1},getFilterName:function(e){var t=e.match(/([a-z]+_){1,2}/i);return t=t[0]?t[0].replace(/(_{1}$)/,""):""},getFilteringModules:function(){for(var e=$$(".cf_wrapp_all"),t=new Array,s=0;s<e.length;s++){var i=e[s].id;i&&parseInt(t.push(i.substring(13)))}return t},getBreadcrumbModules:function(){for(var e=$$(".cf_breadcrumbs_wrapper"),t=new Array,s=0;s<e.length;s++){var i=e[s].getAttribute("data-moduleid");i&&parseInt(t.push(i))}return t},updateFilteringModuleWithSearchQuery:function(e,t){let s=document.getElementById("cf_form_"+e);null!=s&&(s.querySelector("input[name=q]").value=t)},updateSearchModulesWithSearchQuery:function(e){for(var t=document.querySelectorAll(".cf-form-search"),s=0;s<t.length;s++)t[s].querySelector(".cf_message").innerHTML="",t[s].querySelector(".cf_message").setStyle("display","none"),t[s].querySelector("input[name=q]").value=e},loadModule:function(e,t,s){this.httpRequest(t,e,type="module",s)},loadResults:function(e,t){this.httpRequest(e,event=null,type="component",t)},httpRequest:function(e,t,s,i){let r,o="#cf_wrapp_all_"+e,n="",l=!1;void 0!==customFiltersProp[e]&&(void 0!==customFiltersProp[e].results_wrapper&&(n="#"+customFiltersProp[e].results_wrapper),l="module"==s?customFiltersProp[e].use_ajax_spinner:customFiltersProp[e].use_results_ajax_spinner,r=customFiltersProp[e].base_url);let a="module"==s?o:n,u="module"==s?"#cf_ajax_loader_"+e:"#cf_res_ajax_loader",d=document.querySelector("#cf_form_"+e),c=document.querySelector(u),p=document.querySelector(a),m=new XMLHttpRequest;if(i){try{var h=new URL(i,r)}catch(e){return console.error("The supplied url is not valid. Error:"+e),!1}"module"==s&&(h.searchParams.set("view","module"),h.searchParams.set("format","raw"),h.searchParams.set("module_id",e)),h.searchParams.set("tmpl","component"),m.open("POST",h.toString()),m.onloadstart=function(){"component"==s&&window.scrollY-p.getTop()>720&&p.scrollIntoView({behavior:"smooth"}),1==l&&null!=c&&customFilters.formatModuleAjaxOverlay(c,p,t,s)};try{m.send()}catch(e){return console.error("The http request cannot be completed due to error:"+e),!1}}else{let o=new FormData(d);"module"==s?(o.append("view","module"),o.append("format","raw"),o.append("module_id",e)):(-1==(r=d.getAttribute("action")).indexOf("?")?r+="?":r+="&",i=new URLSearchParams(o).toString(),i=r+(i=customFilters.cleanQueryString(i))),o.append("tmpl","component"),o.append("method","post"),m.open("POST",d.getAttribute("action")),m.onloadstart=function(){"component"==s&&window.scrollY-p.getTop()>720&&p.scrollIntoView({behavior:"smooth"}),1==l&&null!=c&&customFilters.formatModuleAjaxOverlay(c,p,t,s)};try{m.send(o)}catch(e){return console.error("The http request cannot be completed due to error:"+e),!1}}return m.onerror=function(){return null!=c&&c.setStyle("display","none"),console.error("The http request cannot be completed due to error:"+m.status+" "+m.statusText),!1},m.onload=function(){null!=c&&c.setStyle("display","none");let t=new Object;if(t.text=m.responseText.removeScripts(function(e){t.script=e}),"component"==s){let e=t.text.match(/<title[^>]*>([\s\S]*?)<\/title>/i);e&&(document.title=e[1]);var r=t.text.match(/<body[^>]*>([\s\S]*?)<\/body>/i);r?t.text=r[1]:console.error("The results response does not contain body element");let s=new Element("div").set("html",t.text).querySelector(n);if(!s)return console.error("The results response does not include the wrapper element:"+n+" Make sure that the breakdesigns ajax plugin is enabled."),!1;t.text=s.innerHTML}if(t.text?p.innerHTML=t.text:p.innerHTML="",t.script)try{window.eval(t.script)}catch(e){console.error(e)}if("component"==s){customFilters.triggerResultsScripts(),i&&customFilters.setWindowState(i);try{customFilters.updateDependentModules(e)}catch(e){console.error(e)}}},!0},cleanQueryString:function(e){return e.split("&").filter(function(e){var t=e.indexOf("="),s=(t<0||e.substr(0,t),e.substr(t+1));return s||0===s}).join("&")},formatModuleAjaxOverlay:function(e,t,s,i){let r=t.getSize(),o=t.getPosition();return"module"==i&&(e.addClass("cf_ajax_loader"),null!=s&&void 0!==s.event&&void 0!==s.event.pageY&&(positionY=s.event.pageY-o.y,e.setStyle("background-position","center "+positionY+"px"))),e.setStyle("display","block"),e.setStyle("height",r.y+"px"),e.setStyle("width",r.x+"px"),!0},triggerResultsScripts:function(){if("undefined"!=typeof Virtuemart&&void 0!==Virtuemart.product&&Virtuemart.product(jQuery("form.product")),"undefined"!=typeof Stockablecustomfields&&"function"==typeof Stockablecustomfields.setEvents?Stockablecustomfields.setEvents():"undefined"!=typeof CustomfieldsForAll&&"function"==typeof CustomfieldsForAll.eventHandler&&CustomfieldsForAll.eventHandler(),"undefined"!=typeof DependentCustomfieldsForAll&&"function"==typeof DependentCustomfieldsForAll.eventHandler){DependentCustomfieldsForAll.eventHandler();let e=jQuery("form.product");setTimeout(function(){DependentCustomfieldsForAll.handleForms(e)},13)}return jQuery(".orderlistcontainer").hover(function(){jQuery(this).find(".orderlist").stop().show()},function(){jQuery(this).find(".orderlist").stop().hide()}),!0},updateDependentModules:function(e){for(var t=customFilters.getBreadcrumbModules(),s=customFiltersProp[e].base_url+"index.php?option=com_customfilters&view=module",i=0;i<t.length;i++)customFilters.loadModule(event=void 0,t[i],s);return!0},setWindowState:function(e){this.counterHist++;window.history.state;window.history.pushState&&window.history.replaceState&&window.history.pushState({page:this.counterHist},"Search Results",e)},addEventTree:function(e){var t="virtuemart_category_id";if(0==customFiltersProp[e].parent_link){function s(s,i){s.stop();var r,o=i.getProperty("class").split(" ");i.hasClass("cf_unexpand")?(i.removeClass("cf_unexpand"),i.addClass("cf_expand")):i.hasClass("cf_expand")&&(i.removeClass("cf_expand"),i.addClass("cf_unexpand"));for(var n=0;n<o.length;n++)o[n].indexOf("tree")>=0&&(r=o[n]);var l=i.getProperty("id");if(l=parseInt(l.slice(l.indexOf("_elid")+5)),r){r+="-"+l;var a=document.id("cf_list_"+t+"_"+e).getElements(".li-"+r);if(a[0].hasClass("cf_invisible"))var u=!1;else u=!0;for(n=0;n<a.length;n++)if(0==u)a[n].removeClass("cf_invisible");else for(var d=document.id("cf_list_"+t+"_"+e).getElements("li[class*="+r+"]"),c=0;c<d.length;c++)d[c].addClass("cf_invisible"),d[c].hasClass("cf_parentLi")&&(d[c].getElement("a").removeClass("cf_expand"),d[c].getElement("a").addClass("cf_unexpand"))}}document.id("cf_wrapp_all_"+e).addEvent("click:relay(.cf_parentOpt)",function(e,t){return s(e,t),!1}),document.id("cf_wrapp_all_"+e).addEvent("keydown:relay(.cf_parentOpt)",function(e,t){return"enter"!=e.key&&"right"!=e.key&&"left"!=e.key||s(e,t),!1})}},addEventsRangeInputs:function(e,t){var s=e+"_"+t,i=document.id(s+"_0"),r=document.id(s+"_1");if(i&&r){customFilters.validateRangeFlt(t,e);var o=document.id(s+"_slider");i.addEvent("keyup",function(s){var i=customFilters.validateRangeFlt(t,e);null!=o&&customFilters.setSliderValues(t,e,i,"min")}),r.addEvent("keyup",function(s){var i=customFilters.validateRangeFlt(t,e);null!=o&&customFilters.setSliderValues(t,e,i,"max")}),"btn"==customFiltersProp[t].results_trigger&&(i.addEvent("change",function(s){customFilters.validateRangeFlt(t,e)&&customFilters.listen(i,t)}),r.addEvent("change",function(s){customFilters.validateRangeFlt(t,e)&&customFilters.listen(r,t)}))}},createToggle:function(e,t){var s=jQuery("#cf_wrapper_inner_"+e),i=Cookie.read(e)?Cookie.read(e):t,r="show"==i;s.toggle(r),customFilters.setHeaderClass(e,i),customFilters.setAriaExpanded(e,i),document.querySelector("#cfhead_"+e).addEventListener("click",function(t){if(s.toggle(),s.is(":visible"))var i="show";else i="hide";customFilters.setHeaderClass(e,i),customFilters.setAriaExpanded(e,i);Cookie.write(e,i)})},setHeaderClass:function(e,t){let s="headexpand_"+e,i=document.getElementById(s);"hide"==t?(i.removeClass("headexpand_show"),i.addClass("headexpand_hide")):(i.removeClass("headexpand_hide"),i.addClass("headexpand_show"))},setAriaExpanded:function(e,t){let s="#cfhead_"+e,i=document.querySelector(s);"hide"==t?i.setAttribute("aria-expanded","false"):i.setAttribute("aria-expanded","true")},validateRangeFlt:function(e,t){let s=t+"_"+e;const i=document.getElementById(s+"_0"),r=document.getElementById(s+"_1");let o=null;"btn"!=customFiltersProp[e].results_trigger&&(o=document.getElementById(s+"_button"));let n=i.value.replace(",",".");var l=n.match(/^[+-]?\d+(\.\d*)?$/);let a=r.value.replace(",",".");var u=a.match(/^[+-]?\d+(\.\d*)?$/);return l&&0==a.length||u&&0==n.length||l&&u?n.length>0&&a.length>0&&parseFloat(n)>parseFloat(a)?(o&&o.setAttribute("disabled","disabled"),this.displayMsg("",s),!1):(o&&o.removeAttribute("disabled"),this.displayMsg("",s),new Array(n,a)):(o&&o.setAttribute("disabled","disabled"),a.length>0||n.length>0?this.displayMsg(Joomla.JText._("MOD_CF_FILTERING_INVALID_CHARACTER"),s):this.displayMsg("",s),!1)},validateInput:function(e,t){let s=e+"_"+t,i=document.getElementById(s+"_0");return!i||(i.value.length<2?(this.displayMsg(Joomla.JText._("MOD_CF_FILTERING_MIN_CHARACTERS_LIMIT"),s),!1):(this.displayMsg("",s),!0))},displayMsg:function(e,t){var s=document.getElementById(t+"_message");e?(s.style.display="block",s.innerHTML=e):s.style.display="none"},setSliderValues:function(module_id,filter,valid,minOrMax){var flt_key=filter+"_"+module_id,sliderObj=eval(flt_key+"_sliderObj");if(0!=valid){var min_val=parseInt(valid[0]);isNaN(min_val)&&(min_val=parseInt(customFiltersProp[module_id].slider_min_value));var max_val=parseInt(valid[1]);isNaN(max_val)&&(max_val=parseInt(customFiltersProp[module_id].slider_max_value)),sliderObj.setMin(min_val),sliderObj.setMax(max_val)}else"min"==minOrMax?sliderObj.setMin(parseInt(customFiltersProp[module_id].slider_min_value)):"max"==minOrMax&&sliderObj.setMax(parseInt(customFiltersProp[module_id].slider_max_value))}},CfElementFilter=new Class({Implements:[Options,Events],options:{module_id:null,isexpanable_tree:!1,filter_key:"",cache:!0,caseSensitive:!1,ignoreKeys:[13,27,32,37,38,39,40],matchAnywhere:!0,optionClass:".cf_option",property:"text",trigger:"keyup",onHide:"",onComplete:"",onStart:function(){this.elements.addClass("cf_hide")},onShow:function(e){e.removeClass("cf_hide")},onMatchText:function(e){var t=this.observeElement.value,s=this.options.caseSensitive?"":"i",i=new RegExp(t,s),r=e.getElements(this.options.optionClass),o=r[0].get(this.options.property),n=o.toLowerCase(),l=t.toLowerCase(),a=n.indexOf(l),u=o.substr(a,t.length),d=o.replace(i,'<span class="cf_match">'+u+"</span>");r[0].set("html",d)}},initialize:function(e,t,s){this.setOptions(s),this.observeElement=document.id(e),this.elements=$$(t),this.matches=this.elements,this.listen()},listen:function(){this.observeElement.addEvent(this.options.trigger,function(e){this.observeElement.value.length?this.options.ignoreKeys.contains(e.code)||(this.fireEvent("start"),this.findMatches(this.options.cache?this.matches:this.elements),this.fireEvent("complete")):(this.elements.removeClass("cf_hide"),this.clearHtmlFromText(this.elements),this.findMatches(this.elements,!1),this.elements.getElements(".cf_invisible").each(function(e){e.setStyle("display","")}))}.bind(this))},findMatches:function(e,t){var s=this.observeElement.value,i=this.options.matchAnywhere?s:"^"+s,r=this.options.caseSensitive?"":"i",o=new RegExp(i,r);e.each(function(e){var s=null==t?o.test(e.get(this.options.property)):t,i=e.getProperty("class").contains("cf_invisible"," ");return s?(i&&e.setStyle("display","block"),this.fireEvent("matchText",[e]),this.fireEvent("show",[e])):(i&&e.setStyle("display",""),e.retrieve("showing")&&this.fireEvent("hide",[e]),e.store("showing",!1)),!0}.bind(this))},clearHtmlFromText:function(e){e.each(function(e){var t=e.getElements(this.options.optionClass),s=t[0].get(this.options.property);t[0].set("html",s)}.bind(this))}});class CfTooltip{constructor(e,t){this.attachElement=document.querySelector(e),Array.isArray(this.attachElement)&&(this.attachElement=this.attachElement[0]),this.id=t,this.tip,this.init()}init(){return this.tip=document.querySelector("#"+this.id),this.positionX(),!0}getPosition(){let e=this.attachElement;return{top:e.offsetTop,left:e.offsetLeft}}positionX(){let e=this.getPosition();this.tip.style.left=parseInt(e.left)-5+"px"}positionY(){let e=this.getPosition();this.tip.style.top=parseInt(e.top)+20+"px"}getValue(){let e=this.attachElement.getAttribute("data-tooltip");return e||(e=""),e}setValue(e){return this.tip.innerHTML=e,this.attachElement.setAttribute("data-tooltip",e),this.attachElement.setAttribute("aria-valuenow",e),!0}}String.prototype.removeScripts=function(e){let t="",s=this.replace(/<script[^>]*type="application\/json"[^>]*>([\s\S]*?)<\/script>/gi,function(e,s){t+="'"+s+"'\n"}).replace(/<script[^>]*>([\s\S]*?)<\/script>/gi,function(e,s){return t+=s+"\n",""});return"function"==typeOf(e)&&e(t,s),s};